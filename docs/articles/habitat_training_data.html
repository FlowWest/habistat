<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habitat Training Data • habistat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Habitat Training Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">habistat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_overview.html">Model Overview</a>
    </li>
    <li>
      <a href="../articles/habitat_training_data.html">Habitat Training Data</a>
    </li>
    <li>
      <a href="../articles/predictor_variables.html">Predictor Variables</a>
    </li>
    <li>
      <a href="../articles/statistical_model.html">Statistical Model Development, Training, and Prediction</a>
    </li>
    <li>
      <a href="../articles/duration_analysis.html">Duration Analysis</a>
    </li>
    <li>
      <a href="../articles/watershed_aggregation.html">Watershed Delineation and Flow Aggregation</a>
    </li>
    <li>
      <a href="../articles/spawning_extents.html">Spawning Extents</a>
    </li>
    <li>
      <a href="../articles/interactive_map.html">Interactive Map User Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://flowwest.shinyapps.io/habistat/" class="external-link">Interactive Map</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Habitat Training Data</h1>
                        <h4 data-toc-skip class="author">
<a href="mailto:mrubenson@flowwest.com">Maddee Wiggins</a> &amp; <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>
</h4>
            
            <h4 data-toc-skip class="date">2025-03-04</h4>
      

      <div class="hidden name"><code>habitat_training_data.Rmd</code></div>

    </div>

    
    
<p><span class="key_takeaways">Depth and velocity outputs from existing
two-dimensional hydraulic models were assembled for “training reaches”
within the study area, at a variety of flows. The depth and velocity
raster grids (for HEC-RAS 2D models) or vector meshes (for SRH-2D
models) were divided up based on ComID reach delineations from the
National Hydrography Dataset. A habitat suitability index was applied
based on depth and velocity values (e.g. 1 if a cell is within suitable
depth and velocity range, else 0). Then, habitat suitability was
summarized for each reach, at each flow, into a measure of total
suitable habitat area per linear foot of channel, for each flow. The
result is a flow-to-suitable-area curve for each reach in the training
dataset, normalized by linear feet to be independent of arbitrary reach
length.</span></p>
<div class="section level2">
<h2 id="data-sources">Data Sources<a class="anchor" aria-label="anchor" href="#data-sources"></a>
</h2>
<p>Depth and velocity outputs from existing two-dimensional hydraulic
models were assembled for “training reaches” within the study area, at a
variety of flows. The model is currently trained on the following
models:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th>Stream</th>
<th>Extent</th>
<th>Length</th>
<th>Author</th>
<th>Year</th>
<th>Platform</th>
<th>Flow Range</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Deer Creek</td>
<td>Delaney Slough to Sacramento River confluence</td>
<td>54,000 LF</td>
<td>FlowWest</td>
<td>2021</td>
<td>HEC-RAS 2D</td>
<td>100 - 15,000 cfs</td>
</tr>
<tr class="even">
<td>Lower Yuba River</td>
<td>Englebright Dam to Feather River confluence</td>
<td>120,000 LF</td>
<td>cbec, Inc</td>
<td>2020</td>
<td>SRH-2D</td>
<td>300 - 110,400 cfs</td>
</tr>
<tr class="odd">
<td>Stanislaus River</td>
<td>Knights Ferry to San Joaquin River confluence</td>
<td>280,000 LF</td>
<td>NewFields</td>
<td>2013</td>
<td>SRH-2D</td>
<td>500 - 5,000 cfs</td>
</tr>
<tr class="even">
<td>Tuolumne River</td>
<td>Basso-La Grange Reach</td>
<td>22,000 LF</td>
<td>FlowWest</td>
<td>2022</td>
<td>HEC-RAS 2D</td>
<td>80 - 9,600 cfs</td>
</tr>
<tr class="odd">
<td>Mokelumne River</td>
<td>Camanche Dam to North/South Mokelume Divergence</td>
<td>162,000 LF</td>
<td>EBMUD</td>
<td>2015 (rev. 2023)</td>
<td>HEC-RAS 2D</td>
<td>100 - 5,000 cfs</td>
</tr>
</tbody>
</table>
<p>Datasets are temporarily filtered to a maximum flow of 15,000 cfs
during model development.</p>
<p><img src="figures/training-data-reaches-1.png" width="700"></p>
<p>The depth and velocity raster grids (for HEC-RAS 2D models) or vector
meshes (for SRH-2D models) were divided up based on ComID reach
delineations. Currently, this is a manual process that requires
importing the model domain polygon into a GIS system, splitting it up
into reaches, and assigning each reach a ComID number that corresponds
to the overlapping NHDPlusV2 flowline.</p>
</div>
<div class="section level2">
<h2 id="habitat-suitability-index">Habitat Suitability Index<a class="anchor" aria-label="anchor" href="#habitat-suitability-index"></a>
</h2>
<p>A habitat suitability index was applied to each grid/mesh cell based
on depth and velocity values. The simplest habitat suitability indices
are binary, <em>i.e.</em>, 1 if a cell is within suitable depth and
velocity range, else 0), and this approach is currently being used.
However, it is possible to instead use a habitat suitability index that
includes “somewhat suitable” fractional values between 0 and 1.</p>
<div class="section level3">
<h3 id="rearing">Rearing<a class="anchor" aria-label="anchor" href="#rearing"></a>
</h3>
<p>We applied the following habitat suitability index (all units are in
feet):</p>
<blockquote>
<p>HSI = 1 if (d&gt;1.0 &amp; d&lt;=3.28 &amp; v&gt;0 &amp; v&lt;=1.5)
else 0</p>
</blockquote>
<p>This was developed for floodplain rearing for the <a href="https://www.sfei.org/sites/default/files/biblio_files/SalmonHQT_UserGuide_2019.pdf" class="external-link">Chinook
Salmon Habitat Quantification Tool</a> published by SFEI. According to
this report,</p>
<blockquote>
<p>Suitable depths support foraging behavior and predator avoidance
(Gregory 1993) and contribute to favorable primary production
conditions. Juvenile Chinook salmon habitat suitability models for depth
and velocity have been developed previously for numerous rivers in the
Central Valley and elsewhere (Aceituno 1990) and applied to floodplain
habitat estimates for the San Joaquin River (SJRRP 2012). These
estimates suggest optimal depth values exist between 0.3 and 1 m (1–3.28
ft) in floodplain or off-channel conditions, and these depths are used
in accepted HSI (Habitat Suitability Index) models (Figure A.6; Aceituno
1990, SJRRP 2012). The same studies, based on the velocity requirements
for juvenile Chinook salmon, assigned optimal velocity values for those
habitat types at between 0–0.46 m/sec (0–1.5 ft/sec; Figure A.6;
Aceituno 1990).</p>
</blockquote>
<p>An alternative habitat suitability index was also tested:</p>
<blockquote>
<p>HSI = 1 if (d&gt;0.5 &amp; d&lt;=5.2 &amp; v&gt;0 &amp; v&lt;=4.0)
else 0</p>
</blockquote>
<p>This index, derived from “juvenile salmonid observations from 11
different northern California rivers,” was “developed for the California
State Water Resources Control Board Voluntary Settlement Agreement and …
agreed upon by a committee of interested stakeholders as part of the
Voluntary Settlement Agreement process during a meeting held November 9,
2017.” It was previously applied by cbec, Inc in the Yuba River Flow
Effects Modeling Project<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
</div>
<div class="section level3">
<h3 id="spawning">Spawning<a class="anchor" aria-label="anchor" href="#spawning"></a>
</h3>
<p>For spawning, we derived general habitat suitability criteria from a
dataset compiled by Mark Gard for use in <a href="https://cvpia-osc.github.io/DSMhabitat/" class="external-link">CVPIA DSMHabitat</a>.
Within the dataset are spawning criteria for depth, velocity, and
substrate for 11 watersheds and Fall, Late Fall, Winter, Spring for
Chinook Salmon. The depth factor of the HSI, as the least-restrictive
estimate, uses the maximum depth with a nonzero suitability across all
of the runs analyzed.</p>
<blockquote>
<p>HSI<sub>depth</sub> = 1 if d&lt;=6.56 else 0</p>
</blockquote>
<p><img src="figures/hsi_spawning_depth.png"></p>
<p>For winter run, a minimum depth also applies:</p>
<blockquote>
<p>HSI<sub>depth</sub> = 1 if (d &gt; 1.00 &amp; d&lt;=6.56) else 0</p>
</blockquote>
<p>The velocity factor of the HSI, rather than a binary threshold, uses
a curve relationship with fractional suitabilities. This curve is the
upper envelope of all the individual suitability curves for different
runs.</p>
<p><img src="figures/hsi_spawning_velocity.png"></p>
<p>If both depth and velocity criteria were fractional, then a geometric
mean would be an appropriate method of combining the two. However, with
the binary criterion, simple multiplication is appropriate. The overall
suitability equals the velocity suitability if and only if the depth is
suitable, otherwise the overall suitability is zero.</p>
<blockquote>
<p>HSI = HSI<sub>depth</sub> * HSI<sub>velocity</sub> =
min(HSI<sub>depth</sub>, HSI<sub>velocity</sub>)</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="depth-and-velocity-data-processing">Depth and Velocity Data Processing<a class="anchor" aria-label="anchor" href="#depth-and-velocity-data-processing"></a>
</h2>
<p>The selected habitat suitability index was applied to the depth and
velocity raster grids (for HEC-RAS 2D models) or vector meshes (for
SRH-2D models). The habistat team developed a series of R
functions–built with the <code>dplyr</code>, <code>sf</code>, and
<code>terra</code> libraries–to import model geometry and depth/velocity
results, apply habitat suitability indices, and summarize results by
ComID reach. Both workflows consist of the following steps:</p>
<ul>
<li>Import depth and velocity grid/mesh for a particular flow.</li>
<li>Calculate area (ft<sup>2</sup>) of each grid/mesh cell</li>
<li>Calculate suitability (between 1 and 0) for each grid/mesh cell</li>
<li>Calculate suitable area of each grid/mesh cell by multiplying area
by suitability</li>
<li>Aggregate grid/mesh cells by ComID (reach) polygon, calculating
total area and total suitable area</li>
<li>Divide total area and total suitable area by the length of the
corresponding flowline (linear ft)</li>
</ul>
<p>This process is conducted for each set of depth/velocity rasters
corresponding to each flow.</p>
<p>The result is two values for each ComID (reach) at each flow. Units
are ft2/ft, which simplifies to ft:</p>
<ul>
<li><p><strong>suitable area per linear ft</strong> is our habitat
variable of interest– the effective habitat area in the channel,
normalized by reach length so that the (somewhat arbitrary) division of
reaches does not influence model outputs. Because it’s an area divided
by a length, it can also be thought of as an “effective width of
habitat.”</p></li>
<li><p><strong>total inundated area per linear ft</strong> can likewise
be interpreted as the average width of wetted channel at the given flow.
This is useful for comparison purposes.</p></li>
</ul>
<div class="section level3">
<h3 id="vector-functions-for-srh-2d-model-outputs">Vector Functions for SRH-2D Model Outputs<a class="anchor" aria-label="anchor" href="#vector-functions-for-srh-2d-model-outputs"></a>
</h3>
<ul>
<li>
<a href="../reference/vector_prep_mesh.html"><code>vector_prep_mesh</code></a>
imports a polygon shapefile describing model cells, and calculates the
area of each cell.</li>
<li>
<a href="../reference/vector_import_srh2d.html"><code>vector_import_srh2d</code></a>
imports a series of tabular datasets containing the depth and velocity
estimates by cell for all flows.</li>
<li>
<a href="../reference/vector_calculate_hsi.html"><code>vector_calculate_hsi</code></a>
creates habitat suitability index estimates for each cell based on the
specified suitability criteria.</li>
<li>
<a href="../reference/vector_summarize_hsi.html"><code>vector_summarize_hsi</code></a>
calculates suitable area of each grid/mesh cell by multiplying area by
suitability, then aggregates cells by ComID (reach) polygon, calculating
total area and total suitable area.</li>
<li>
<a href="../reference/suitability_postprocess.html"><code>suitability_postprocess</code></a>
spatially joins the ComID (reach) polygons to the NHD flowlines, then
divides total area and total suitable area by the length of the
corresponding flowline. The result is <em>total inundated area (ft2) per
linear ft</em> and <em>suitable habitat area (ft2) per linear ft</em>
for each reach, at each flow.</li>
</ul>
</div>
<div class="section level3">
<h3 id="raster-functions-for-hec-ras-2d-model-outputs">Raster Functions for HEC-RAS 2D Model Outputs<a class="anchor" aria-label="anchor" href="#raster-functions-for-hec-ras-2d-model-outputs"></a>
</h3>
<ul>
<li>
<a href="../reference/raster_prep_grid.html"><code>raster_prep_grid</code></a>
imports depth and velocity grid/mesh for all flows and combines them
into a <code>terra</code> raster dataset.</li>
<li>
<a href="../reference/raster_summarize_hsi.html"><code>raster_summarize_hsi</code></a>
applies the specified habitat suitability index, then calculates zonal
statistics by ComID (reach) polygon to achieve total area and total
suitable area for each polygon.</li>
<li>
<a href="../reference/suitability_postprocess.html"><code>suitability_postprocess</code></a>
spatially joins the ComID (reach) polygons to the NHD flowlines, then
divides total area and total suitable area by the length of the
corresponding flowline. The result is <em>total inundated area (ft2) per
linear ft</em> and <em>suitable habitat area (ft2) per linear ft</em>
for each reach, at each flow.</li>
</ul>
</div>
<div class="section level3">
<h3 id="baseflow-channel-removal">Baseflow Channel Removal<a class="anchor" aria-label="anchor" href="#baseflow-channel-removal"></a>
</h3>
<p>For rearing reaches, it is also necessary to eliminate the area
within the perennial baseflow channel, even where depths and velocities
are within the suitable range of the habitat suitability index (HSI),
“due to lack of cover and food production mechanisms.”<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>This is achieved by zeroing out the grid cells corresponding to the
baseflow channel in the original hydraulic model output, prior to
summarizing habitat suitability and creating the training dataset. The
spatial extent of the baseflow channel can be estimated by choosing a
specific baseflow (cfs) for each training reach and clipping out the
inundation extent at this flow. In most cases, this is the minimum of
the available flows in the provided hydraulic model results grids.</p>
<p>The development team tested an alternative method which keeps the
baseflow channel in the training dataset, and instead eliminates
baseflow in the non-hydraulically modeled reaches after prediction. This
is achieved by simply altering the duration suitability criteria to
‘zero out’ high durations (e.g. &gt;=100 days). However, it was
determined that the assumptions inherent in the duratio suitability
method would produce less accurate baseflow channel removal than simply
spatially clipping.</p>
</div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>The summarized habitat training dataset by reach is available in the
data package as <a href="../reference/wua_hydraulic.html"><code>wua_hydraulic</code></a>.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>cbec, inc. <em>Yuba River Flow Effects Modeling Project
- Lower Yuba River Habitat Evaluation Report</em>. Prepared for Trout
Unlimited and USFWS, 30 Sept. 2022.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>CBEC (2022). Yuba River Flow Effects Modeling Project
Lower Yuba River Temporal Habitat Evaluation Report. CBEC Project
#19-1029. <a href="https://drive.google.com/file/d/1UUjj0BxwIvbgL2k-frld6Fytx-bmi2Of/view" class="external-link uri">https://drive.google.com/file/d/1UUjj0BxwIvbgL2k-frld6Fytx-bmi2Of/view</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddee Wiggins, <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
