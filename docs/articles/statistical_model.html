<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistical Model Development, Training, and Prediction • habistat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Statistical Model Development, Training, and Prediction">
<meta property="og:description" content="habistat">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">habistat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_overview.html">Model Overview</a>
    </li>
    <li>
      <a href="../articles/habitat_training_data.html">Habitat Training Data</a>
    </li>
    <li>
      <a href="../articles/predictor_variables.html">Predictor Variables</a>
    </li>
    <li>
      <a href="../articles/statistical_model.html">Statistical Model Development, Training, and Prediction</a>
    </li>
    <li>
      <a href="../articles/duration_analysis.html">Duration Analysis and Baseflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://flowwest.shinyapps.io/swc-habistat-dev/" class="external-link">Interactive Map</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Statistical Model Development, Training, and
Prediction</h1>
                        <h4 data-toc-skip class="author">
<a href="mailto:mrubenson@flowwest.com">Maddee Rubenson</a> &amp; <a href="slewis@flowwest.com">Skyler Lewis</a>
</h4>
            
            <h4 data-toc-skip class="date">2024-10-17</h4>
      
      
      <div class="hidden name"><code>statistical_model.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="section"></h2>
<p>We are currently developing and refining a statistical model to
predict flow-to-suitable-habitat-area relationships for stream reaches
in the Sacramento-San Joaquin Basin, based on a variety of
widely-available geospatial and hydrologic variables. Predictor variable
data collection is detailed in the <a href="predictor_variables.html">Predictor Variables</a> article.</p>
</div>
<div class="section level2">
<h2 id="model-development">Model Development<a class="anchor" aria-label="anchor" href="#model-development"></a>
</h2>
<div class="section level3">
<h3 id="general-model-form">General Model Form<a class="anchor" aria-label="anchor" href="#general-model-form"></a>
</h3>
<p>In practice, suitable habitat area is modeled as a function of flow,
the suite of predictor variables, and the interactions between each
predictor variable and flow. As applied in a linear regression model,
the general functional form for the model is as follows. The use of the
interaction terms allows the model to estimate not only the average
effect of each predictor variable on suitable area, but also the effect
of each predictor variable on the flow-to-suitable-area
relationship.</p>
<p><span class="math inline">\(\mathbf{h} = \alpha + \beta\mathbf{q} +
\pmb{\gamma}\mathbf{X} + \pmb{\delta}\mathbf{q}\mathbf{X} +
\epsilon\)</span></p>
<ul>
<li>
<span class="math inline">\(\mathbf{h}\)</span> = suitable habitat
area, WUA per linear ft (response variable)</li>
<li>
<span class="math inline">\(\mathbf{q}\)</span> = streamflow
(cfs)</li>
<li>
<span class="math inline">\(\mathbf{X}\)</span> = matrix of
predictor variables (slope, drainage area, etc.)</li>
<li>
<span class="math inline">\(\alpha\)</span> = estimated
intercept</li>
<li>
<span class="math inline">\(\beta\)</span> = estimated coefficient
on flow (i.e. constant effect of flow on habitat)</li>
<li>
<span class="math inline">\(\pmb{\gamma}\)</span> = estimated
coefficients of predictor variables (i.e., constant effect of each
predictor on habitat)</li>
<li>
<span class="math inline">\(\pmb{\delta}\)</span> = estimated
coefficients of interactions (i.e., effect of each predictor on the
flow-to-habitat relationship)</li>
<li>
<span class="math inline">\(\epsilon\)</span> = error term</li>
</ul>
<p>Expressed without using matrix notation, the model estimate for each
NHD ComID reach <span class="math inline">\(i\)</span> and flow <span class="math inline">\(q\)</span> is…</p>
<p><span class="math inline">\({SuitableHabitatArea}_{i,q} = \alpha +
\beta{Flow}_{q} + \gamma_1{Slope}_{i} + \delta_1{Flow}_{q}{Slope}_{i} +
\gamma_2{DrainageArea}_{i} + \delta_2{Flow}_{q}{DrainageArea}_{i} + ...
+ \epsilon\)</span></p>
<p>… and so on for all other predictor variables with estimated
coefficients <span class="math inline">\(\gamma_3\)</span>, <span class="math inline">\(\delta_3\)</span>, <span class="math inline">\(\gamma_4\)</span>, <span class="math inline">\(\delta_4\)</span>, etc.</p>
</div>
<div class="section level3">
<h3 id="transformations-and-weights">Transformations and Weights<a class="anchor" aria-label="anchor" href="#transformations-and-weights"></a>
</h3>
<p>We originally log-transformed the habitat, flow, and predictor
variables for three reasons: (a) to limit the effect of extreme values;
(b) to align with typical hydrologic conventions of using power series
models; and (c) for interpretability because log-log model coefficients
represent elasticities (“percent change in y per percent change in x).
Because some predictor variables include values less than or equal to
zero, the log transformation was replaced with a variation on the
inverse hyperbolic sine (asinh) transformation. Because <span class="math inline">\(\mathrm{asinh}(x) = \ln(x +
\sqrt{x^2+1})\)</span>, this transformation behaves like a log
transformation for positive values (<span class="math inline">\(\mathrm{asinh}(x) \rightarrow \ln(2x) \text{ as }
x \rightarrow \infty\)</span>) but remains defined for zero values and
has a comparable, mirrored shape for negative values.</p>
<p>Additionally, all predictor variables were centered and scaled after
transformations were applied.</p>
<p>The length (linear ft) of each reach (<code>comid</code>) was applied
as a case weight. Reaches vary substantially in length from several feet
to 26 miles, with a mean length of 1.2 miles. Weighting the estimate by
linear ft allows longer reaches to have greater influence on the model
and makes the somewhat arbitrary <code>comid</code> delineations less
relevant.</p>
<pre><code><span><span class="co">#&gt; Warning in log(x): NaNs produced</span></span>
<span></span>
<span><span class="co">#&gt; Warning in log(x): NaNs produced</span></span>
<span><span class="co">#&gt; Warning: Removed 30 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Removed 30 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre>
<p><img src="figures/statistical-model-asinh-transform-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="three-model-versions-tested">Three Model Versions Tested<a class="anchor" aria-label="anchor" href="#three-model-versions-tested"></a>
</h3>
<p>Three forms of the model were tested, discussed in sequence in the
following sections.</p>
<div class="section level4">
<h4 id="model-version-1-habitat-arealf-vs-flow">Model Version 1: Habitat Area/LF vs Flow<a class="anchor" aria-label="anchor" href="#model-version-1-habitat-arealf-vs-flow"></a>
</h4>
<p>This is the simplest and most straightforward version of the
model.</p>
<blockquote>
<p><strong>Habitat variable</strong>: Suitable habitat area (WUA) per
linear ft, aka “effective habitat width”</p>
<p><strong>Flow variable</strong>: Flow (cfs)</p>
<p><strong>Predictor variables</strong>:</p>
<ul>
<li>
<strong>Reach characteristics</strong>: slope, bankfull depth,
bankfull width-depth ratio, baseflow index, % clay, % sand,
permeability, depth to bedrock, mean annual precipitation, MTPI
(topographic position index), valley bottom width, valley
bottom-bankfull width ratio, fractional levee confinement, channel
sinuosity</li>
<li>
<strong>Catchment characteristics</strong>: drainage area, mean
elevation, mean annual precipitation, avg erodibility, avg slope, avg
NDVI</li>
</ul>
<p><strong>Transformations</strong>:</p>
<ul>
<li>Inverse hyperbolic sine</li>
<li>Interaction between slope and drainage area</li>
<li>Center and scale all predictors</li>
</ul>
<p><strong>Model forms</strong>: Linear regression; Random forest
regression</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="model-version-2-normalized-habitat-arealf-vs-normalized-flow">Model Version 2: Normalized Habitat Area/LF vs Normalized Flow<a class="anchor" aria-label="anchor" href="#model-version-2-normalized-habitat-arealf-vs-normalized-flow"></a>
</h4>
<p>This model is a variation on Version 1. It is intended to deal with
the problem of differing ranges of flows across training datasets on
account of the differing sizes of the river systems.</p>
<p>A scalar was defined for each reach (<code>comid</code>),
representing the magnitude of flow in the watershed. A product of the
drainage area and mean annual precipitation with units of million acre
feet (Maf), this value represents the average quantity of water input
into the reach’s catchment in a year:</p>
<p><span class="math inline">\({Scalar [\mathrm{Maf}]} = 10^{-6} \times
{DA [\mathrm{ac}]} \times {MAP [\mathrm{ft}]}\)</span></p>
<p>The habitat and flow variables are multiplied by this scalar prior to
prediction, then divided by the scalar after prediction.</p>
<blockquote>
<p><strong>Habitat variable</strong>: Suitable habitat area (WUA) per
linear ft <strong>normalized by DA*MAP</strong></p>
<p><strong>Flow variable</strong>: Flow (cfs) <strong>normalized by
DA*MAP</strong></p>
<p><strong>Predictor variables</strong>:</p>
<ul>
<li>
<strong>Reach characteristics</strong>: slope, <del>bankfull
depth</del>, bankfull width-depth ratio, baseflow index, % clay, % sand,
permeability, depth to bedrock, <del>mean annual precipitation</del>,
MTPI (topographic position index), valley bottom width, valley
bottom-bankfull width ratio, fractional levee confinement, channel
sinuosity</li>
<li>
<strong>Catchment characteristics</strong>: drainage area, mean
elevation, mean annual precipitation, avg erodibility, avg slope, avg
NDVI</li>
</ul>
<p><strong>Transformations</strong>:</p>
<ul>
<li>Inverse hyperbolic sine</li>
<li><del>Interaction between slope and drainage area</del></li>
<li>Center and scale all predictors</li>
</ul>
<p><strong>Model forms</strong>: Linear regression; Random forest
regression</p>
</blockquote>
<p>Compared to Version 1, the normalized Version 2 model creates
flow-to-suitable-area curves that are more strongly proportional to the
size of the river.</p>
</div>
<div class="section level4">
<h4 id="model-version-3-total-arealf-vs-flow-habitat-vs-normalized-flow">Model Version 3: (Total Area/LF vs Flow) * (% Habitat vs Normalized
Flow)<a class="anchor" aria-label="anchor" href="#model-version-3-total-arealf-vs-flow-habitat-vs-normalized-flow"></a>
</h4>
<p>…details here…</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="linear-regression-results">Linear Regression Results<a class="anchor" aria-label="anchor" href="#linear-regression-results"></a>
</h2>
<ul>
<li><p>Doesn’t produce a great fit, but useful for exploring effects of
predictor variables</p></li>
<li><p>Collinearity between variables is not addressed as this is only
exploratory</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="random-forest-regression">Random Forest Regression<a class="anchor" aria-label="anchor" href="#random-forest-regression"></a>
</h2>
<p>Random Forest Regression is a decision tree based machine learning
alternative to linear regression. The model specifications are
essentially identical to the linear regression formulations previously
dicsussed. Unlike linear regression, there is no constraint on the
functional form of the flow-to-habitat relationship or the effects of
predictor variables.</p>
<div class="section level3">
<h3 id="model-results">Model Results<a class="anchor" aria-label="anchor" href="#model-results"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
</div>
<div class="section level3">
<h3 id="by">By<a class="anchor" aria-label="anchor" href="#by"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="functional-regression">Functional Regression<a class="anchor" aria-label="anchor" href="#functional-regression"></a>
</h2>
<p>Conceptually, we are thinking of suitable area to flow relationship
is a function of a suite of predictor variables.</p>
<ol start="3" style="list-style-type: decimal">
<li><p><strong>Training statistical model</strong>: The hydraulically
modeled flow-to-suitable-area relationships developed for reaches in
Step 2 are joined to the reach predictor variable table from Step 1.
This dataset (one observation per flow per reach) is then used to train
a statistical model that can be used to predict flow-to-suitable-area
curves for reaches that are not hydraulically modeled. Random Forest
Regression, a decision tree-based machine learning approach, allows for
non-linear relationships between suitable habitat, flow, and the array
of predictor variables. The model development process is detailed in the
<a href="statistical_model.html">Statistical Model</a> article.</p></li>
<li><p><strong>Predicting habitat output</strong>: The trained
statistical model can now be used to predict flow-to-suitable-area
relationships for other streams within the study area. While the
statistical model will produce predictions for any stream with valid
predictor data, the validity and trustworthiness of predictions will
depend on those streams’ similarity to the training dataset. As training
datasets are currently limited to foothill alluvial systems on major
tributary streams, only these should be considered valid. The prediction
process is detailed in the <a href="statistical_model.html">Statistical
Model</a> article, and <em>preliminary</em> flow-to-suitable-habitat
predictions are included in the data package <a href="https://flowwest.shinyapps.io/habistat/" class="external-link">Map App</a>.</p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddee Rubenson, <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
