<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistical Model Development, Training, and Prediction • habistat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Statistical Model Development, Training, and Prediction">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">habistat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_overview.html">Model Overview</a>
    </li>
    <li>
      <a href="../articles/habitat_training_data.html">Habitat Training Data</a>
    </li>
    <li>
      <a href="../articles/predictor_variables.html">Predictor Variables</a>
    </li>
    <li>
      <a href="../articles/statistical_model.html">Statistical Model Development, Training, and Prediction</a>
    </li>
    <li>
      <a href="../articles/duration_analysis.html">Duration Analysis</a>
    </li>
    <li>
      <a href="../articles/watershed_aggregation.html">Watershed Delineation and Flow Aggregation</a>
    </li>
    <li>
      <a href="../articles/spawning_extents.html">Spawning Extents</a>
    </li>
    <li>
      <a href="../articles/interactive_map.html">Interactive Map User Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://flowwest.shinyapps.io/habistat/" class="external-link">Interactive Map</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Statistical Model Development, Training, and
Prediction</h1>
                        <h4 data-toc-skip class="author">
<a href="mailto:mrubenson@flowwest.com">Maddee Wiggins</a> &amp; <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>
</h4>
            
            <h4 data-toc-skip class="date">2025-03-04</h4>
      

      <div class="hidden name"><code>statistical_model.Rmd</code></div>

    </div>

    
    
<p><span class="key_takeaways"> The hydraulically modeled
flow-to-suitable-area relationships developed for reaches in Step 2 are
joined to the reach predictor variable table from Step 1. This dataset
(one observation per flow per reach) is then used to train a statistical
model that can be used to predict flow-to-suitable-area curves for
reaches that are not hydraulically modeled. Random Forest Regression, a
decision tree-based machine learning approach, allows for non-linear
relationships between suitable habitat, flow, and the array of predictor
variables. </span></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>We are currently developing and refining a statistical model to
predict flow-to-suitable-habitat-area relationships for stream reaches
in the Sacramento-San Joaquin Basin, based on a variety of
widely-available geospatial and hydrologic variables. Predictor variable
data collection is detailed in the <a href="predictor_variables.html">Predictor Variables</a> article.</p>
<p>This statistical model method was developed for predicting rearing
habitat area versus flow at the <code>comid</code> scale.</p>
<p>It is also applied for spawning habitat area, given training data
generated using different habitat suitability indices (see <a href="habitat_training_data.html">Habitat Training Data</a>), with
additional post-model filters required to eliminate areas that are
non-suitable due to substrate (see <a href="spawning_extents.html">Spawning Extents</a>).</p>
<p>Raw outputs from this method are then ready to be scaled based on
hydrology and duration requirements (see <a href="duration_analysis.html">Duration Analysis</a>) and/or aggregated
at the river or watershed level (see <a href="watershed_aggregation.html">Watershed Aggregation</a>).</p>
</div>
<div class="section level2">
<h2 id="model-development">Model Development<a class="anchor" aria-label="anchor" href="#model-development"></a>
</h2>
<div class="section level3">
<h3 id="general-model-form">General Model Form<a class="anchor" aria-label="anchor" href="#general-model-form"></a>
</h3>
<p>In practice, suitable habitat area is modeled as a function of flow,
the suite of predictor variables, and the interactions between each
predictor variable and flow. As applied in a linear regression model,
the general functional form for the model is as follows. The use of the
interaction terms allows the model to estimate not only the average
effect of each predictor variable on suitable area, but also the effect
of each predictor variable on the flow-to-suitable-area
relationship.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐡</mi><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><mi>𝐪</mi><mo>+</mo><mi>𝛄</mi><mi>𝐗</mi><mo>+</mo><mi>𝛅</mi><mi>𝐪</mi><mi>𝐗</mi><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\mathbf{h} = \alpha + \beta\mathbf{q} + \pmb{\gamma}\mathbf{X} + \pmb{\delta}\mathbf{q}\mathbf{X} + \epsilon</annotation></semantics></math></p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐡</mi><annotation encoding="application/x-tex">\mathbf{h}</annotation></semantics></math>
= suitable habitat area, WUA per linear ft (response variable)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐪</mi><annotation encoding="application/x-tex">\mathbf{q}</annotation></semantics></math>
= streamflow (cfs)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\mathbf{X}</annotation></semantics></math>
= matrix of predictor variables (slope, drainage area, etc.)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
= estimated intercept</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
= estimated coefficient on flow (i.e. constant effect of flow on
habitat)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛄</mi><annotation encoding="application/x-tex">\pmb{\gamma}</annotation></semantics></math>
= estimated coefficients of predictor variables (i.e., constant effect
of each predictor on habitat)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛅</mi><annotation encoding="application/x-tex">\pmb{\delta}</annotation></semantics></math>
= estimated coefficients of interactions (i.e., effect of each predictor
on the flow-to-habitat relationship)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϵ</mi><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math>
= error term</li>
</ul>
<p>Expressed without using matrix notation, the model estimate for each
NHD ComID reach
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and flow
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
is…</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi>S</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi>H</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>A</mi><mi>r</mi><mi>e</mi><mi>a</mi></mrow><mrow><mi>i</mi><mo>,</mo><mi>q</mi></mrow></msub><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><msub><mrow><mi>F</mi><mi>l</mi><mi>o</mi><mi>w</mi></mrow><mi>q</mi></msub><mo>+</mo><msub><mi>γ</mi><mn>1</mn></msub><msub><mrow><mi>S</mi><mi>l</mi><mi>o</mi><mi>p</mi><mi>e</mi></mrow><mi>i</mi></msub><mo>+</mo><msub><mi>δ</mi><mn>1</mn></msub><msub><mrow><mi>F</mi><mi>l</mi><mi>o</mi><mi>w</mi></mrow><mi>q</mi></msub><msub><mrow><mi>S</mi><mi>l</mi><mi>o</mi><mi>p</mi><mi>e</mi></mrow><mi>i</mi></msub><mo>+</mo><msub><mi>γ</mi><mn>2</mn></msub><msub><mrow><mi>D</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>e</mi><mi>a</mi></mrow><mi>i</mi></msub><mo>+</mo><msub><mi>δ</mi><mn>2</mn></msub><msub><mrow><mi>F</mi><mi>l</mi><mi>o</mi><mi>w</mi></mrow><mi>q</mi></msub><msub><mrow><mi>D</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>A</mi><mi>r</mi><mi>e</mi><mi>a</mi></mrow><mi>i</mi></msub><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">{SuitableHabitatArea}_{i,q} = \alpha + \beta{Flow}_{q} + \gamma_1{Slope}_{i} + \delta_1{Flow}_{q}{Slope}_{i} + \gamma_2{DrainageArea}_{i} + \delta_2{Flow}_{q}{DrainageArea}_{i} + ... + \epsilon</annotation></semantics></math></p>
<p>… and so on for all other predictor variables with estimated
coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mn>3</mn></msub><annotation encoding="application/x-tex">\gamma_3</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>δ</mi><mn>3</mn></msub><annotation encoding="application/x-tex">\delta_3</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mn>4</mn></msub><annotation encoding="application/x-tex">\gamma_4</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>δ</mi><mn>4</mn></msub><annotation encoding="application/x-tex">\delta_4</annotation></semantics></math>,
etc.</p>
</div>
<div class="section level3">
<h3 id="transformations-and-weights">Transformations and Weights<a class="anchor" aria-label="anchor" href="#transformations-and-weights"></a>
</h3>
<p>We originally log-transformed the habitat, flow, and predictor
variables for three reasons: (a) to limit the effect of extreme values;
(b) to align with typical hydrologic conventions of using power series
models; and (c) for interpretability because log-log model coefficients
represent elasticities (“percent change in y per percent change in x).
Because some predictor variables include values less than or equal to
zero, the log transformation was replaced with a variation on the
inverse hyperbolic sine (asinh) transformation. Because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">h</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>+</mo><msqrt><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow></msqrt><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{asinh}(x) = \ln(x + \sqrt{x^2+1})</annotation></semantics></math>,
this transformation behaves like a log transformation for positive
values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">h</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>→</mo><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> as </mtext><mspace width="0.333em"></mspace></mrow><mi>x</mi><mo>→</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">\mathrm{asinh}(x) \rightarrow \ln(2x) \text{ as } x \rightarrow \infty</annotation></semantics></math>)
but remains defined for zero values and has a comparable, mirrored shape
for negative values.</p>
<p>Additionally, all predictor variables were centered and scaled after
transformations were applied.</p>
<p>The length (linear ft) of each reach (<code>comid</code>) was applied
as a case weight. Reaches vary substantially in length from several feet
to 26 miles, with a mean length of 1.2 miles. Weighting the estimate by
linear ft allows longer reaches to have greater influence on the model
and makes the somewhat arbitrary <code>comid</code> delineations less
relevant.</p>
<p><img src="figures/statistical-model-asinh-transform-1.png" width="624"></p>
</div>
<div class="section level3">
<h3 id="flow-variable">Flow Variable<a class="anchor" aria-label="anchor" href="#flow-variable"></a>
</h3>
<p>Training flow data are resampled to a regular sequence of flows that
is evenly spaced on a logarithmic axis:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interp_flows</span> <span class="op">&lt;-</span> <span class="fu">habistat</span><span class="fu">::</span><span class="fu"><a href="../reference/seq_log10.html">seq_log10</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">15000</span>, <span class="fl">0.05</span>, snap<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/statistical-model-interp_flows-1.png" width="624"></p>
</div>
<div class="section level3">
<h3 id="model-versions-tested">Model Versions Tested<a class="anchor" aria-label="anchor" href="#model-versions-tested"></a>
</h3>
<p>Two forms of the model were tested, discussed in sequence in the
following sections.</p>
<div class="section level4">
<h4 id="model-version-1-habitat-arealf-vs-flow">Model Version 1: Habitat Area/LF vs Flow<a class="anchor" aria-label="anchor" href="#model-version-1-habitat-arealf-vs-flow"></a>
</h4>
<p>This is the simplest and most straightforward version of the
model.</p>
<blockquote>
<p><strong>Habitat variable</strong>: Suitable habitat area (WUA) per
linear ft, aka “effective habitat width”</p>
<p><strong>Flow variable</strong>: Flow (cfs)</p>
<p><strong>Predictor variables</strong>:</p>
<ul>
<li>
<strong>Reach characteristics</strong>: slope, bankfull depth,
bankfull width-depth ratio, baseflow index, % clay, % sand,
permeability, depth to bedrock, mean annual precipitation, MTPI
(topographic position index), valley bottom width, valley
bottom-bankfull width ratio, fractional levee confinement, channel
sinuosity</li>
<li>
<strong>Catchment characteristics</strong>: drainage area, mean
elevation, mean annual precipitation, avg erodibility, avg slope, avg
NDVI</li>
</ul>
<p><strong>Transformations</strong>:</p>
<ul>
<li>Inverse hyperbolic sine</li>
<li>Interaction between slope and drainage area</li>
<li>Center and scale all predictors</li>
</ul>
<p><strong>Model forms</strong>: Linear regression; Random forest
regression</p>
</blockquote>
</div>
<div class="section level4">
<h4 id="model-version-2-normalized-habitat-arealf-vs-normalized-flow">Model Version 2: Normalized Habitat Area/LF vs Normalized Flow<a class="anchor" aria-label="anchor" href="#model-version-2-normalized-habitat-arealf-vs-normalized-flow"></a>
</h4>
<p>This model is a variation on Version 1. It is intended to deal with
the problem of differing ranges of flows across training datasets on
account of the differing sizes of the river systems.</p>
<p>A scalar was defined for each reach (<code>comid</code>),
representing the magnitude of flow in the watershed. A product of the
drainage area and mean annual precipitation with units of million acre
feet (Maf), this value represents the average quantity of water input
into the reach’s catchment in a year:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>S</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>r</mi><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">f</mi></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mo>=</mo><msup><mn>10</mn><mrow><mi>−</mi><mn>6</mn></mrow></msup><mo>×</mo><mrow><mi>D</mi><mi>A</mi><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">c</mi></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mo>×</mo><mrow><mi>M</mi><mi>A</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mi mathvariant="normal">f</mi><mi mathvariant="normal">t</mi></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">{Scalar [\mathrm{Maf}]} = 10^{-6} \times {DA [\mathrm{ac}]} \times {MAP [\mathrm{ft}]}</annotation></semantics></math></p>
<p>The habitat and flow variables are multiplied by this scalar prior to
prediction, then divided by the scalar after prediction.</p>
<blockquote>
<p><strong>Habitat variable</strong>: Suitable habitat area (WUA) per
linear ft <strong>normalized by DA*MAP</strong></p>
<p><strong>Flow variable</strong>: Flow (cfs) <strong>normalized by
DA*MAP</strong></p>
<p><strong>Predictor variables</strong>:</p>
<ul>
<li>
<strong>Reach characteristics</strong>: slope, <del>bankfull
depth</del>, bankfull width-depth ratio, baseflow index, % clay, % sand,
permeability, depth to bedrock, <del>mean annual precipitation</del>,
MTPI (topographic position index), valley bottom width, valley
bottom-bankfull width ratio, fractional levee confinement, channel
sinuosity</li>
<li>
<strong>Catchment characteristics</strong>: drainage area, mean
elevation, mean annual precipitation, avg erodibility, avg slope, avg
NDVI</li>
</ul>
<p><strong>Transformations</strong>:</p>
<ul>
<li>Inverse hyperbolic sine</li>
<li><del>Interaction between slope and drainage area</del></li>
<li>Center and scale all predictors</li>
</ul>
<p><strong>Model forms</strong>: Linear regression; Random forest
regression</p>
</blockquote>
<p>Compared to Version 1, the normalized Version 2 model creates
flow-to-suitable-area curves that are more strongly proportional to the
size of the river.</p>
</div>
<div class="section level4">
<h4 id="ensemble-model">Ensemble Model<a class="anchor" aria-label="anchor" href="#ensemble-model"></a>
</h4>
<p>The ensemble model is the average of the output of the Version 1 and
Version 2 models for each unique combination of <code>comid</code> and
flow.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="exploratory-linear-regression">Exploratory Linear Regression<a class="anchor" aria-label="anchor" href="#exploratory-linear-regression"></a>
</h2>
<p>Linear regression was useful for exploring the effects of predictor
variables and testing different model forms. However, the collinearity
between variables and the limitations on the functional shape of
relationships were limitations.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Model Version 1: Scale-Dependent</th>
<th>Model Version 2: Scale-Normalized</th>
</tr></thead>
<tbody><tr class="odd">
<td><img src="figures/lm-sd2-coeffs-1.png" style="width:100.0%"></td>
<td><img src="figures/lm-si2-coeffs-1.png" style="width:100.0%"></td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="random-forest-regression-model">Random Forest Regression Model<a class="anchor" aria-label="anchor" href="#random-forest-regression-model"></a>
</h2>
<p>Random Forest Regression is a decision tree based machine learning
alternative to linear regression. The model specifications are
essentially identical to the linear regression formulations previously
discussed. Unlike linear regression, there is no constraint on the
functional form of the flow-to-habitat relationship or the effects of
predictor variables. Random forest models are fit using the
<code>ranger</code> package via the <code>tidymodels</code>
framework.</p>
<ul>
<li><p><strong>Train/Test Split</strong>: Flowlines
(<code>comid</code>s) and their associated training data are split into
training and testing datasets at a 75% training/25% testing random
split, stratified by river and hydrologic class.</p></li>
<li><p><strong>IHS Transformation</strong>: As described in the section
above, all continuous numeric variables are transformed using the
transformation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mi>′</mi><mo>=</mo><mtext mathvariant="normal">asinh</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>100</mn><mo>⋅</mo><mi>x</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">x' = \text{asinh}(100 \cdot x / 2)</annotation></semantics></math>.
Variables that represent proportions or ratios are not transformed. The
response variable is also transformed.</p></li>
<li><p><strong>DA/MAP Normalization</strong>: For the “scale-normalized”
model, all variables are divided by the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>D</mi><mi>A</mi></mrow><mo>*</mo><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow></mrow><annotation encoding="application/x-tex">{DA}*{MAP}</annotation></semantics></math>
scaling factor described above.</p></li>
<li><p><strong>Interaction</strong>: Any predictor variables included in
the model are also included as interactions with flow:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mi>′</mi><mo>⋅</mo><mi>Q</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x' \cdot Q)</annotation></semantics></math>.</p></li>
<li><p><strong>Feature Selection</strong>: The training dataset is used
for feature selection, i.e., identifying the set of predictor variables
to be used in the prediction. We iteratively test versions of the model
with and without each predictor variable. Predictor variables selected
for inclusion are those that improve model fit (decrease RMSE) when they
are included relative to when they are excluded.</p></li>
<li><p><strong>Parameter Tuning</strong>: Random forest model parameters
are tuned using 10-fold cross-validation with the training dataset.
Tuned parameters are the number of trees (<code>trees</code>), number of
predictors that will be randomly sampled at each split when creating the
tree models (<code>mtry</code>), and the minimum number of data points
in a node that are required for the node to be split further
(<code>min_n</code>).</p></li>
<li><p><strong>Prediction</strong>: Once a final tuned model has been
selected, the full dataset of flowlines (<code>comid</code>s) and their
attributes are input, once for each flow along a a regular log sequence
of flows matching the <code>interp_flows</code> sequence described
above. Predictions are run for all <code>comid</code>s; filters are
applied after the fact.</p></li>
<li><p><strong>Inverse IHS Transformation</strong>: Transformed
variables and the final output are reverse-transformed using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mtext mathvariant="normal">sinh</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>⋅</mo><mn>2</mn><mi>/</mi><mn>100</mn></mrow><annotation encoding="application/x-tex">x = \text{sinh}(x') \cdot 2 / 100</annotation></semantics></math>.</p></li>
<li><p><strong>Inverse DA/MAP Normalization</strong>: For the
“scale-normalized” model, normalization is reversed by multiplying the
result by the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>D</mi><mi>A</mi></mrow><mo>*</mo><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow></mrow><annotation encoding="application/x-tex">{DA}*{MAP}</annotation></semantics></math>
scaling factor described above.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>The trained statistical model can now be used to predict
flow-to-suitable-area relationships for other streams within the study
area. While the statistical model will produce predictions for any
stream with valid predictor data, the validity and trustworthiness of
predictions will depend on those streams’ similarity to the training
dataset. As training datasets are currently limited to foothill alluvial
systems on major tributary streams, only these should be considered
valid.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddee Wiggins, <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
