<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watershed Delineation and Flow Aggregation • habistat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Watershed Delineation and Flow Aggregation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">habistat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_overview.html">Model Overview</a>
    </li>
    <li>
      <a href="../articles/habitat_training_data.html">Habitat Training Data</a>
    </li>
    <li>
      <a href="../articles/predictor_variables.html">Predictor Variables</a>
    </li>
    <li>
      <a href="../articles/statistical_model.html">Statistical Model Development, Training, and Prediction</a>
    </li>
    <li>
      <a href="../articles/duration_analysis.html">Duration Analysis</a>
    </li>
    <li>
      <a href="../articles/watershed_aggregation.html">Watershed Delineation and Flow Aggregation</a>
    </li>
    <li>
      <a href="../articles/spawning_extents.html">Spawning Extents</a>
    </li>
    <li>
      <a href="../articles/interactive_map.html">Interactive Map User Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://flowwest.shinyapps.io/habistat/" class="external-link">Interactive Map</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Watershed Delineation and Flow Aggregation</h1>
                        <h4 data-toc-skip class="author"><a href="slewis@flowwest.com">Skyler Lewis</a></h4>
            
            <h4 data-toc-skip class="date">2025-03-04</h4>
      

      <div class="hidden name"><code>watershed_aggregation.Rmd</code></div>

    </div>

    
    
<p><span class="key_takeaways"> Reach-scale predictions are aggregated
to the scale of the river (mainstem) reach or watershed for usability in
decision support models and other applications. Aggregating reach-scale
predictions across a river or watershed extent is more complicating than
adding up habitat values at a given flow, because instantaneous flows at
different points in the watershed differ. This article describes the
delineation of watersheds and mainstems, as well as the method for
aggregating reach-scale predictions. </span></p>
<div class="section level2">
<h2 id="delineation">Delineation<a class="anchor" aria-label="anchor" href="#delineation"></a>
</h2>
<p>The <strong>Central Valley Mainstems</strong> dataset <a href="../reference/cv_mainstems.html"><code>cv_mainstems</code></a>
contains joined flowlines and attributes for major habitat streams in
the Sacramento and San Joaquin Valleys. This dataset is derived from the
following sources.</p>
<p>Current habitat streams are derived primarily from the <a href="https://cvpia-osc.github.io/DSMhabitat/articles/habitat-extents-map.html" class="external-link">CVPIA
DSMHabitat Spawning and Rearing Habitat layer</a>. This dataset
delineates spawning and rearing reach extents by run (Fall Run Chinook,
Spring Run Chinook, and Steelhead). For the habistat project, spawning
and rearing extents were mapped onto NHD ComID reaches. To create a
run-agnostic map of maximum potential spawning and rearing habitat
extents, reaches identified as spawning reaches for any run are labelled
as spawning reaches, and likewise for rearing. River names were modified
to distinguish different forks and tributaries within the same
watershed. (In the dataset, the <code>river_group</code> attribute
describes the watershed, e.g. <code>Cottonwood Creek</code>, while the
<code>river_cvpia</code> attribute describes the distinct river name,
e.g. <code>North Fork Cottonwood Creek</code>.)</p>
<p>Historic and potential habitat streams are mapped from the historical
extents described by Yoshiyama et al. (2001)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> delineation. Naming
conventions align with that described for the current habitat streams.
Scope is presently limited to the Sacramento and San Joaquin basins and
does not include the Tulare basin.</p>
<p>The <strong>Central Valley Watersheds</strong> dataset <a href="../reference/cv_watersheds.html"><code>cv_watersheds</code></a>
describes the drainage area associated with the mainstem groups.
Watersheds are grouped and dissolved based on USGS WBD subcatchment
polygons. Watershed names are nested hierarchically to make summary
statistics clearer.</p>
<ul>
<li>
<code>watershed_level_1</code> distinguishes the Sacramento versus
San Joaquin basins.</li>
<li>
<code>watershed_level_2</code> identifies catchments that flow
directly into the Sacramento and San Joaquin rivers.</li>
<li>
<code>watershed_level_3</code> is the canonical watershed name that
aligns with the <code>river_group</code> attribute in the
<code>cv_mainstems</code> dataset.</li>
</ul>
<p>For example, the Yuba River watershed is:</p>
<ul>
<li>
<code>watershed_level_1</code> = “Sacramento River”</li>
<li>
<code>watershed_level_2</code> = “Feather River”</li>
<li>
<code>watershed_level_3</code> = “Yuba River”</li>
</ul>
<p>while the Feather River watershed (not including the Yuba) is:</p>
<ul>
<li>
<code>watershed_level_1</code> = “Sacramento River”</li>
<li>
<code>watershed_level_2</code> = “Feather River”</li>
<li>
<code>watershed_level_3</code> = “Feather River”</li>
</ul>
<p>The Upper Sacramento River and Upper San Joaquin River are treated as
distinct tributaries of the Sacramento River and San Joaquin River
respectively. They have their own <code>river_group</code> and
<code>watershed_level_3</code> names.</p>
<p><img src="figures/model-overview-watershed-map-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="aggregation">Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h2>
<div class="section level3">
<h3 id="aggregation-of-flow-to-suitable-habitat-area-curves">Aggregation of flow-to-suitable habitat area curves<a class="anchor" aria-label="anchor" href="#aggregation-of-flow-to-suitable-habitat-area-curves"></a>
</h3>
<p>Aggregating flow-to-suitable-area relationships from the individual
<code>comid</code> reach to the river- or watershed-scale is not as
simple as summing or averaging the curves. This is because, at a
particular point in time, flow is not the same at all points in the
river or watershed. For a river- or watershed-scale habitat curve, the
nominal “flow” is the flow at the downstream end of the river in
question, or the outlet point of the watershed. Habitat area for a given
flow is the sum of the habitat area at the outlet reach for that flow,
and all the habitat area upstream at whatever the <em>corresponding
flows</em> are.</p>
<p>When the nominal flow at the outlet is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Q</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">Q_{outlet}</annotation></semantics></math>,
the flow for some prediction point (comid) farther up in the watershed
is assumed to be</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>Q</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub><mo>*</mo><mfrac><msub><mrow><mi>D</mi><mi>A</mi></mrow><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><msub><mrow><mi>D</mi><mi>A</mi></mrow><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub></mfrac><mo>*</mo><mfrac><msub><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><msub><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">Q_{point} = Q_{outlet} * \frac{{DA}_{point}}{{DA}_{outlet}} * \frac{{MAP}_{point}}{{MAP}_{outlet}}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">DA</annotation></semantics></math>
is the drainage area for the prediction point or outlet and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">MAP</annotation></semantics></math>
is the mean annual precipitation for the prediction point or outlet.</p>
<p>Looking at habitat area is a function of flow
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Q</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">H(Q)</annotation></semantics></math>),
the habitat area for the watershed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mrow><mi>w</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msub><annotation encoding="application/x-tex">{H}_{watershed}</annotation></semantics></math>
at nominal flow
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Q</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">Q_{outlet}</annotation></semantics></math>
is the sum of the habitat areas for individual points
(<code>comid</code>s) at their respective <em>corresponding
flows</em>:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mi>w</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>h</mi><mi>e</mi><mi>d</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Q</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>H</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Q</mi><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>l</mi><mi>e</mi><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>H</mi><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Q</mi><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>H</mi><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mn>2</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Q</mi><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi><mn>2</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>.</mi><mi>.</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">H_{watershed}(Q_{outlet}) = {H}_{outlet}(Q_{outlet}) + {H}_{point1}(Q_{point1}) + {H}_{point2}(Q_{point2}) + ...</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="aggregation-of-flow-to-duration-suitability-curves">Aggregation of flow-to-duration suitability curves<a class="anchor" aria-label="anchor" href="#aggregation-of-flow-to-duration-suitability-curves"></a>
</h3>
<p>For calculating duration suitability at an individual prediction
point (<code>comid</code>), as described in <a href="duration_analysis.html">Duration Analysis</a>, the flow values on
the inundation duration curve are scaled from the streamgage to the
prediction point using an equivalent method.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>=</mo><msub><mi>Q</mi><mrow><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub><mo>*</mo><mfrac><msub><mrow><mi>D</mi><mi>A</mi></mrow><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><msub><mrow><mi>D</mi><mi>A</mi></mrow><mrow><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub></mfrac><mo>*</mo><mfrac><msub><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><mrow><mi>p</mi><mi>o</mi><mi>i</mi><mi>n</mi><mi>t</mi></mrow></msub><msub><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><mrow><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">Q_{point} = Q_{gage} * \frac{{DA}_{point}}{{DA}_{gage}} * \frac{{MAP}_{point}}{{MAP}_{gage}}</annotation></semantics></math></p>
<p>Then, this scaled duration curve is applied to the
flow-to-suitable-area curve for the <code>comid</code> using the methods
described in <a href="duration_analysis.html">Duration Analysis</a>.
Finally, the duration-scaled flow-to-suitable-area curves for all
relevant <code>comid</code>s within the watershed are aggregated using
the methods described above.</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>R. M. Yoshiyama, E. R. Gerstung, F. W. Fisher, and P. B.
Moyle. (2001). Historic and present distribution of Chinook salmon in
the central valley drainage of California. In R. L. Brown, editor, Fish
Bulletin 179: Contributions to the biology of Central Valley salmonids.,
volume 1, pages 71– 176. California Department of Fish and Game,
Sacramento, CA.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddee Wiggins, <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
