<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Duration Analysis • habistat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Duration Analysis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">habistat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_overview.html">Model Overview</a>
    </li>
    <li>
      <a href="../articles/habitat_training_data.html">Habitat Training Data</a>
    </li>
    <li>
      <a href="../articles/predictor_variables.html">Predictor Variables</a>
    </li>
    <li>
      <a href="../articles/statistical_model.html">Statistical Model Development, Training, and Prediction</a>
    </li>
    <li>
      <a href="../articles/duration_analysis.html">Duration Analysis</a>
    </li>
    <li>
      <a href="../articles/watershed_aggregation.html">Watershed Delineation and Flow Aggregation</a>
    </li>
    <li>
      <a href="../articles/spawning_extents.html">Spawning Extents</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://flowwest.shinyapps.io/habistat/" class="external-link">Interactive Map</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Duration Analysis</h1>
                        <h4 data-toc-skip class="author">
<a href="mailto:mrubenson@flowwest.com">Maddee Rubenson</a> &amp; <a href="slewis@flowwest.com">Skyler Lewis</a>
</h4>
            
            <h4 data-toc-skip class="date">2024-11-07</h4>
      

      <div class="hidden name"><code>duration_analysis.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="duration-analysis">Duration Analysis<a class="anchor" aria-label="anchor" href="#duration-analysis"></a>
</h2>
<p>The habitat areas (flow-to-suitable-area curves) predicted by the <a href="statistical_model.html">Statistical Model</a> are derived from
depth- and velocity-based habitat suitability index (HSI) criteria only.
Duration of inundation was not included at the statistical model step
because it does not have the same one-to-one predictable relationship
with flow: the duration of inundation at a given flow will vary by local
hydrology and by water year. Sometimes we might be interested in
simulating a historic hydrology, other times we might be considering a
potential future hydrology, so the ability to vary the inundation
duration factor is necessary.</p>
<div class="section level3">
<h3 id="spatial-method">Spatial Method<a class="anchor" aria-label="anchor" href="#spatial-method"></a>
</h3>
<p>To precisely apply suitability criteria for inundation duration,
inundation duration factors would need to be applied at the individual
grid cell level in the same manner as depth and velocity.</p>
<p>For example, a series of depth raster grids at different flows,
calculated using a hydraulic model, can be used to determine the first
inundating flow for a given grid cell. (For raster models, this can be
calculated using the <a href="../reference/raster_first_inundating_flow.html"><code>raster_first_inundating_flow</code></a>
function in habistat.) This example is shown for the Deer Creek
hydraulic model:</p>
<p><img src="figures/duration_deer_fif.png"></p>
<p>Given a hydrograph for a particular water year, a relationship can be
derived between flow and the number of contiguous days in a water year
at which that flow is exceeded. This method is implemented in the
habistat function <a href="../reference/duration_calc_days_inundated.html"><code>duration_calc_days_inundated</code></a>.</p>
<p><img src="figures/duration_example_2_rating_curve.png"></p>
<p>Combining the previous two steps, a spatial map of inundation
duration can be created for this particular water year.</p>
<p><img src="figures/duration_deer_max.png"></p>
<p>These duration values can then be used, in the same manner as depth
and velocity, to calculate a habitat suitability index at each model
grid cell.</p>
<p>However, for training the statistical model in habistat, we need a
single flow-to-suitable-area curve for each reach to feed into the
statistical model–<em>not</em> a series of curves for every potential
hydrology.</p>
</div>
<div class="section level3">
<h3 id="non-spatial-method">Non-Spatial Method<a class="anchor" aria-label="anchor" href="#non-spatial-method"></a>
</h3>
<p>To solve this issue, habistat includes a simplified method of
applying inundation duration criteria to an already generated
flow-to-suitable-area curve, approximating a duration-weighted
estimate:</p>
<p><img src="figures/flowchart_duration.png"></p>
<div class="section level4">
<h4 id="input-flow-to-suitable-area-curve">Input flow-to-suitable-area curve<a class="anchor" aria-label="anchor" href="#input-flow-to-suitable-area-curve"></a>
</h4>
<p>We start with the static depth and velocity based
flow-to-suitable-area curve, predicted by the habistat <a href="statistical_model.html">Statistical Model</a>. The same method
could also be applied to a flow-to-suitable-area curve calculated
through a different manner.</p>
</div>
<div class="section level4">
<h4 id="hydrograph-datasets">Hydrograph Datasets<a class="anchor" aria-label="anchor" href="#hydrograph-datasets"></a>
</h4>
<p>Next, we pull a hydrograph and calculate the inundation duration at
each flow. To summarize the hydrology of a water year, the maximum
contiguous days exceeding each given flow is calculated.</p>
<p>One inundation duration curve is calculated per salmonid run, per
water year type group.</p>
<div class="section level5">
<h5 id="salmonid-runs">Salmonid Runs<a class="anchor" aria-label="anchor" href="#salmonid-runs"></a>
</h5>
<p>To capture only ecologically relevant time windows, we filter the
hydrographs by relevant months for the salmonid run of interest:
<mark>CITE?</mark></p>
<table style="width:51%;" class="table">
<colgroup>
<col width="18%">
<col width="16%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th>Run</th>
<th>Rearing</th>
<th>Spawning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Fall</td>
<td>Jan - Jun</td>
<td>Aug - Oct</td>
</tr>
<tr class="even">
<td>Late Fall</td>
<td>Apr - Dec</td>
<td>Jan - Apr</td>
</tr>
<tr class="odd">
<td>Winter</td>
<td>Jul - Mar</td>
<td>May - Aug</td>
</tr>
<tr class="even">
<td>Spring</td>
<td>Nov - May</td>
<td>Aug - Oct</td>
</tr>
<tr class="odd">
<td>Steelhead</td>
<td>Jan - Dec</td>
<td>Jan - Mar</td>
</tr>
</tbody>
</table>
</div>
<div class="section level5">
<h5 id="water-year-type-groups">Water Year Type Groups<a class="anchor" aria-label="anchor" href="#water-year-type-groups"></a>
</h5>
<p>Duration calculations are conducted for as many historical water
years as are available in the streamgage data, and averaged across all
water years within a given <a href="https://data.ca.gov/dataset/cdec-water-year-type-dataset" class="external-link">water
year type</a>. Water year type classifications are regrouped simplified
into <strong>Dry</strong> (“Critical Dry” or “Dry”),
<strong>Normal</strong> (“Below Normal”, “Above Normal”), and
<strong>Wet</strong> (“Wet”) classes.</p>
</div>
</div>
<div class="section level4">
<h4 id="hydrograph-scaling">Hydrograph Scaling<a class="anchor" aria-label="anchor" href="#hydrograph-scaling"></a>
</h4>
<p>If the streamgage being used is not located at the prediction point
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">comid</annotation></semantics></math>),
then the streamgage is scaled to the prediction point using drainage
area
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">DA</annotation></semantics></math>)
and mean annual precipitation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">MAP</annotation></semantics></math>)
ratios. These variables are derived from the habistat predictor variable
dataset for the nearest NHD flowline. This method is consistent with the
flow scaling used for <a href="watershed_aggregation.html">Watershed
Aggregation</a>.</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub><mo>=</mo><msub><mi>Q</mi><mrow><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub><mo>*</mo><mfrac><msub><mrow><mi>D</mi><mi>A</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub><msub><mrow><mi>D</mi><mi>A</mi></mrow><mrow><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub></mfrac><mo>*</mo><mfrac><msub><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>d</mi></mrow></msub><msub><mrow><mi>M</mi><mi>A</mi><mi>P</mi></mrow><mrow><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">Q_{comid} = Q_{gage} * \frac{{DA}_{comid}}{{DA}_{gage}} * \frac{{MAP}_{comid}}{{MAP}_{gage}}</annotation></semantics></math></p>
<p>Hydrograph data was obtained from <a href="https://cdec.water.ca.gov/" class="external-link">CDEC</a> and preprocessed. All active
flow gages on <a href="../reference/cv_mainstems.html"><code>cv_mainstems</code></a>
flowlines are included. Results are stored in:</p>
<ul>
<li>
<a href="../reference/streamgage_attr.html"><code>streamgage_attr</code></a>
= attributes</li>
<li>
<a href="../reference/streamgage_geom.html"><code>streamgage_geom</code></a>
= geometries</li>
<li>
<a href="../reference/streamgage_da_attr.html"><code>streamgage_da_attr</code></a>
= DA and MAP information</li>
<li>
<a href="../reference/streamgage_duration_rating_curves.html"><code>streamgage_duration_rating_curves</code></a>
= calculated duration rating curves</li>
</ul>
</div>
<div class="section level4">
<h4 id="calculating-the-duration-hsi">Calculating the Duration HSI<a class="anchor" aria-label="anchor" href="#calculating-the-duration-hsi"></a>
</h4>
<p>These inundation duration values calculated in the previous step are
next mapped against duration HSI weighting factors, assigning zero for
flows that are never reached.</p>
<p>We apply inundation duration suitability factors for the relevant
habitat type corresponding to fish usage of the river.</p>
<p>For rearing, the duration factors are defined in the Habitat
Quantification Tool based on the gradient class of the river. For
spawning, we assume a minimum of 12 weeks of continuous inundation is
required for spawning and incubation. <mark>CITE?</mark></p>
<table style="width:99%;" class="table">
<colgroup>
<col width="35%">
<col width="35%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Rearing - Valley Lowland</th>
<th>Rearing - Valley Foothill</th>
<th>Spawning</th>
</tr></thead>
<tbody><tr class="odd">
<td><ul>
<li>0 days: 0</li>
<li>1 to 17 days: 0.66</li>
<li>18 to 24 days: 1.00</li>
<li>25+ days: 0.66</li>
</ul></td>
<td><ul>
<li>0 days: 0</li>
<li>1 to 9 days: 1.00</li>
<li>10+ days: 0.66</li>
</ul></td>
<td><ul>
<li>0 days: 0</li>
<li>1 to 83 days: 0</li>
<li>84+ days: 1</li>
</ul></td>
</tr></tbody>
</table>
</div>
<div class="section level4">
<h4 id="applying-the-duration-hsi-to-the-flow-to-suitable-area-curve">Applying the duration HSI to the flow-to-suitable-area curve<a class="anchor" aria-label="anchor" href="#applying-the-duration-hsi-to-the-flow-to-suitable-area-curve"></a>
</h4>
<p>Finally, we combine the flow-to-suitable-area curve and the
flow-to-inundation-duration curve to produce a flow-to-suitable-area
curve that has been scaled down using the duration criteria. The
following figure illustrates the process, which is implemented in the
habistat function <a href="../reference/duration_apply_dhsi_to_fsa_curve.html"><code>duration_apply_dhsi_to_fsa_curve</code></a>.</p>
<p><img src="figures/flowchart_duration_detail.png"></p>
<p>We assume that as we look at increasing flows (on the x axis), the
marginal new habitat being added at each additional flow corresponds to
area being newly inundated at that flow. This is a simplification that
is assumed to reflect the typical case. So, the marginal habitat added
at flow Q is multiplied by the corresponding inundation duration factor
for that flow Q.</p>
<p>In the case where the flow-to-suitable-area curve slopes downward,
the situation is different. The loss in suitable habitat is not
happening at the margin of the channel, it’s happening somewhere within
the channel in the area that was already inundated–most likely because
the water has gotten too deep and too fast. We don’t know exactly where,
so we apply an average of the previous duration factors.</p>
<p>The result is a scaled version of the original flow-to-suitable-area
curve that accounts for the reduction in habitat suitability due to
less-than-optimal duration lengths. The scaled curve will be less than
or equal to the original curve at each flow, but will never exceed
it.</p>
<p><img src="figures/duration_plot_example.png"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Maddee Rubenson, <a href="mailto:slewis@flowwest.com">Skyler Lewis</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
